{% extends 'base_admin.html' %}
{% load static %}
{% block title %}Evaluación Docente por Cuatrimestre{% endblock %}

{% block content %}
<!-- Estilo propio de esta vista -->
<link rel="stylesheet" href="{% static 'css/evaluacion_docente.css' %}">
<!-- CSS de Choices -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

<!-- JS de Choices -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>


<h2 class="titulo-principal">📊 Evaluación Docente por Cuatrimestre</h2>

<!-- Botón para exportar PDF -->
<div class="mt-4 text-center">
    <button id="btnDescargarPDF" class="btn-descargar">🧾 Descargar PDF con Gráficas</button>
</div>

<!-- Tabla editable con formulario -->
<form method="POST" id="tabla-form">
    {% csrf_token %}
    <div class="table-responsive mt-4">
        <table class="table table-bordered table-evaluacion text-center">
            <thead class="table-primary">
                <tr><th>Ciclo Periodo</th><th>Promedio General</th></tr>
            </thead>
            <tbody>
                {% for item in datos %}
                <tr>
                    <td>{{ item.ciclo_periodo }}
                        <input type="hidden" name="ciclo_ids" value="{{ item.ciclo_periodo.id }}">
                    </td>
                    <td>
                        <input type="number" step="0.01" name="promedios" value="{{ item.promedio_general }}"
                            class="form-control text-center" required>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="2">No hay registros aún.</td></tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" name="guardar_tabla" class="btn-guardar w-100">Guardar Cambios</button>
    </div>
</form>

<!-- Filtros -->
<div class="filtros mt-5">
    <h5>🎯 Filtros de visualización</h5>
    <div class="form-check"><input type="checkbox" class="form-check-input" value="linea" checked><label class="form-check-label">Gráfico de Línea</label></div>
    <div class="form-check"><input type="checkbox" class="form-check-input" value="barras" checked><label class="form-check-label">Gráfico de Barras</label></div>
    <div class="form-check"><input type="checkbox" class="form-check-input" value="pastel" checked><label class="form-check-label">Gráfico de Pastel</label></div>
    <div class="form-check"><input type="checkbox" class="form-check-input" value="gauss" checked><label class="form-check-label">Gráfico Gaussiano</label></div>

    <!-- Selector de ciclos -->
    <select id="filtro-ciclos" class="form-control" multiple>
    {% for p in periodos %}
        <option value="{{ p }}">{{ p }}</option>
    {% endfor %}
</select>


    <div class="mt-3">
        <button id="btnAplicar" class="btn btn-primary">Aplicar Filtros</button>
        <button id="btnReset" class="btn btn-secondary">Restablecer</button>
    </div>
</div>

<!-- Contenedor de Gráficas -->
<div class="row mt-4 graficas-container">
    <div class="col-md-6" id="grafico-linea-container">
        <h6>📈 Gráfico de Línea</h6>
        <canvas id="grafico-linea" height="300"></canvas>
    </div>
    <div class="col-md-6" id="grafico-barras-container">
        <h6>📊 Gráfico de Barras</h6>
        <canvas id="grafico-barras" height="300"></canvas>
    </div>
    <div class="col-md-6" id="grafico-pastel-container">
        <h6>🥧 Gráfico de Pastel</h6>
        <canvas id="grafico-pastel" height="300"></canvas>
    </div>
    <div class="col-md-6" id="grafico-gauss-container">
        <h6>📉 Gráfico Gaussiano</h6>
        <canvas id="grafico-gauss" height="300"></canvas>
    </div>
</div>

<!-- Librerías y Script externo -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{% static 'js/evaluacion_docente.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>


<script>
    const etiquetas = {{ etiquetas|safe }};
    const promedios = {{ promedios|safe }};
</script>
{% endblock %}
