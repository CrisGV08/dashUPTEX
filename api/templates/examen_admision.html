{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Examen Admisi칩n{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/examenadmision.css' %}">

<h1>Examen de Admisi칩n y Nuevos ciclos</h1>

{% if mensaje %}
<div id="alertaCiclo" class="alerta-exito">{{ mensaje|safe }}</div>
<script>
setTimeout(() => {
    const alerta = document.getElementById('alertaCiclo');
    if (alerta) {
        alerta.style.transition = "opacity 0.5s ease";
        alerta.style.opacity = "0";
        setTimeout(() => alerta.remove(), 500);
    }
}, 3000);
</script>
{% endif %}

<!-- Botones y filtros -->
<div class="contenedor-superior">
    <form method="POST">{% csrf_token %}
        <button type="submit" name="crear_ciclo" class="btn btn-crear">
            <i class="fas fa-plus-circle"></i> Crear Ciclo / Periodo
        </button>
    </form>
</div>

<div class="botones-superiores">
    <a href="{% url 'descargar_plantilla_nuevo_ingreso' %}" class="btn btn-descargar">
        <i class="fas fa-download"></i> Descargar plantilla Nuevo Ingreso
    </a>
    <form method="POST" action="{% url 'subir_csv_nuevo_ingreso' %}" enctype="multipart/form-data" class="form-csv">
        {% csrf_token %}
        <input type="file" name="archivo_csv" accept=".csv" required>
        <button type="submit" class="btn btn-subir">
            <i class="fas fa-upload"></i> Subir CSV
        </button>
    </form>
</div>

<!-- Filtros -->
<form method="GET" class="filtros-form">
    <div>
        <label><strong>Ciclo:</strong></label>
        <select id="filtroAnio" name="filtro_anio" onchange="this.form.submit()">
            <option value="Todos">Todos</option>
            {% for anio in anios %}
                <option value="{{ anio }}" {% if anio == request.GET.filtro_anio %}selected{% endif %}>{{ anio }}</option>
            {% endfor %}
        </select>
    </div>
</form>

<!-- Contenedor de filtros -->
<div class="filtros-vista">
    <h5>游꿢 Filtros de Visualizaci칩n</h5>
    <div class="filtro-checkboxes">
        <label><strong>Gr치ficas:</strong></label>
        <label><input type="checkbox" class="grafica-check" value="barras" checked> Barras</label>
        <label><input type="checkbox" class="grafica-check" value="linea" checked> L칤nea</label>
        <label><input type="checkbox" class="grafica-check" value="pastel" checked> Pastel</label>
        <label><input type="checkbox" class="grafica-check" value="gauss" checked> Gauss</label>
    </div>
    <div class="filtro-checkboxes">
        <label><strong>Modalidades:</strong></label>
        <label><input type="checkbox" class="modalidad-check" value="examen" checked> Examen</label>
        <label><input type="checkbox" class="modalidad-check" value="renoes" checked> RENOES</label>
        <label><input type="checkbox" class="modalidad-check" value="uaem_gem" checked> UAEM-GEM</label>
        <label><input type="checkbox" class="modalidad-check" value="pase_directo" checked> Pase Directo</label>
    </div>
    <div class="botones-filtros">
        <button type="button" id="aplicarFiltros" class="btn btn-primary">Aplicar Filtros</button>
        <button type="button" id="resetFiltros" class="btn btn-secondary">Restablecer</button>
    </div>
</div>
<div id="datosGraficas"
    data-examen="{{ datos_graficas.examen|default:0 }}"
    data-renoes="{{ datos_graficas.renoes|default:0 }}"
    data-uaem_gem="{{ datos_graficas.uaem_gem|default:0 }}"
    data-pase_directo="{{ datos_graficas.pase_directo|default:0 }}">
</div>

<!-- Secci칩n de gr치ficas -->
<div class="seccion-graficas">
    <h2>Visualizaci칩n Din치mica de Modalidades</h2>
    <div class="graficas-grid">
        <div class="grafica-box" id="box-barras">
            <h5>游늵 Gr치fico de Barras</h5>
            <canvas id="graficaBarras"></canvas>
        </div>
        <div class="grafica-box" id="box-linea">
            <h5>游늳 Gr치fico de L칤nea</h5>
            <canvas id="graficaLinea"></canvas>
        </div>
        <div class="grafica-box" id="box-pastel">
            <h5>游볺 Gr치fico de Pastel</h5>
            <canvas id="graficaPastel"></canvas>
        </div>
        <div class="grafica-box" id="box-gauss">
            <h5>游늴 Campana de Gauss</h5>
            <canvas id="graficaGauss"></canvas>
        </div>
    </div>
</div>

<!-- Tabla -->
<div class="tabla-detalle-programa">
    <h3>Detalle por Programa</h3>
    <table>
        <thead>
            <tr>
                <th>Programa</th>
                <th>Examen</th>
                <th>RENOES</th>
                <th>UAEM-GEM</th>
                <th>Pase Directo</th>
            </tr>
        </thead>
        <tbody>
            {% for fila in detalle_programas %}
            <tr>
                <td>{{ fila.programa }}</td>
                <td>{{ fila.examen }}</td>
                <td>{{ fila.renoes }}</td>
                <td>{{ fila.uaem_gem }}</td>
                <td>{{ fila.pase_directo }}</td>
            </tr>
            {% endfor %}
            {% if detalle_programas %}
            <tr class="total-fila">
                <td>Total</td>
                <td>{{ datos_graficas.examen|default:0 }}</td>
                <td>{{ datos_graficas.renoes|default:0 }}</td>
                <td>{{ datos_graficas.uaem_gem|default:0 }}</td>
                <td>{{ datos_graficas.pase_directo|default:0 }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<div class="text-center mt-4">
    <button id="btnDescargarPDF" class="btn btn-danger">
        游닌 Descargar PDF - Examen de Admisi칩n
    </button>
</div>

<!-- Librer칤as y script JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{% static 'js/examenadmision.js' %}"></script>

{% endblock %}
