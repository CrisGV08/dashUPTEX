{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Titulados Histórico Actual{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/titulados_historico_actual.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">

<div class="admin-panel">
  <h1 class="titulo">📘 Titulados Histórico Actual</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="mensaje-exito">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <!-- Subir / Descargar Excel -->
  <div class="form-box">
    <form method="post" enctype="multipart/form-data" action="{% url 'subir_excel_titulados_historico_actual' %}">
      {% csrf_token %}
      <input type="file" name="archivo_excel" accept=".xlsx, .xls" required>
      <button type="submit" class="btn-admin">📤 Subir Excel</button>
    </form>
    <form method="get" action="{% url 'descargar_plantilla_titulados_historico_actual' %}">
      <button type="submit" class="btn-admin">📥 Descargar Plantilla</button>
    </form>
  </div>

  <!-- Tabla editable -->
  <form method="post">
    {% csrf_token %}
    <div class="table-container">
      <table class="tabla-datos">
        <thead>
          <tr>
            <th>Ingreso</th>
            <th>Programa</th>
            <th>Tit. H</th>
            <th>Tit. M</th>
            <th>DGP H</th>
            <th>DGP M</th>
            <th>Guardar</th>
          </tr>
        </thead>
        <tbody>
          {% for registro in registros %}
          <tr>
            <td>{{ registro.fecha_ingreso.year }}</td>
            <td>
              {% if registro.programa_antiguo %}
                {{ registro.programa_antiguo.nombre }}
              {% elif registro.programa_nuevo %}
                {{ registro.programa_nuevo.nombre }}
              {% else %}
                Sin programa
              {% endif %}
            </td>
            <td><input type="number" name="titulados_h_{{ registro.id }}" value="{{ registro.titulados_h }}"></td>
            <td><input type="number" name="titulados_m_{{ registro.id }}" value="{{ registro.titulados_m }}"></td>
            <td><input type="number" name="dgp_h_{{ registro.id }}" value="{{ registro.registrados_dgp_h }}"></td>
            <td><input type="number" name="dgp_m_{{ registro.id }}" value="{{ registro.registrados_dgp_m }}"></td>
            <td><button type="submit" name="guardar" value="{{ registro.id }}" class="btn-guardar">💾</button></td>
          </tr>
          {% empty %}
          <tr><td colspan="7">No hay registros disponibles.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>

  <!-- Filtros -->
  <div class="filtros">
    <label for="selectCarreras"><strong>Programas:</strong></label>
    <select id="selectCarreras" multiple></select>

    <label for="selectGraficas"><strong>Gráficas:</strong></label>
    <select id="selectGraficas" multiple>
      <option value="linea">Línea</option>
      <option value="barras">Barras</option>
      <option value="pastel">Pastel</option>
      <option value="gauss">Gauss</option>
    </select>

    <button type="button" class="btn-descargar" onclick="descargarPDF()">📄 Descargar PDF</button>
  </div>

  <!-- Contenedor de gráficas -->
  <div class="graficas-container">
    <div class="grafica"><canvas id="graficaLinea"></canvas></div>
    <div class="grafica"><canvas id="graficaBarras"></canvas></div>
    <div class="grafica"><canvas id="graficaPastel"></canvas></div>
    <div class="grafica"><canvas id="graficaGauss"></canvas></div>
  </div>

  <!-- JSON de datos para gráficas -->
  <script type="application/json" id="jsonDatos">
    {{ datos_json|safe }}
  </script>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="{% static 'js/titulados_historico_actual.js' %}"></script>
</div>
{% endblock %}
