{% extends 'base_admin.html' %}
{% load static %}
{% block title %}Evaluación Docente Concentrado{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/evaluacion_docente_concentrado.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<div class="admin-panel">
    <h1 class="titulo">📘 Evaluación Docente Concentrado</h1>

    <!-- Botón PDF -->
    <div class="botones-superiores">
        <button id="btnDescargarPDF" class="btn-admin">🧾 Descargar PDF con Gráficas</button>
    </div>

    <!-- Tabla visible en pantalla -->
    <div class="table-responsive mt-4">
        <table class="table table-bordered text-center">
            <thead class="table-primary">
                <tr>
                    <th>Año Escolar</th>
                    <th>Promedio General</th>
                </tr>
            </thead>
            <tbody>
                {% for d in datos %}
                <tr>
                    <td>{{ d.anio }}</td>
                    <td>{{ d.promedio }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2">No hay datos disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Filtros -->
    <div class="filtros mt-5">
        <h5>🎯 Filtros</h5>
        <div class="form-check"><input type="checkbox" class="grafica-check" value="lineal" checked> Línea</div>
        <div class="form-check"><input type="checkbox" class="grafica-check" value="barras" checked> Barras</div>
        <div class="form-check"><input type="checkbox" class="grafica-check" value="pastel" checked> Pastel</div>
        <div class="form-check"><input type="checkbox" class="grafica-check" value="gauss" checked> Gauss</div>

        <label class="mt-2">Selecciona ciclos:</label>
        <select id="selectCiclos" class="form-control" multiple></select>
    </div>

    <!-- Contenido para PDF -->
    <div id="contenidoParaPDF" class="mt-5">

        <!-- Gráficas -->
        <div class="row mt-4 graficas-container">
            <div class="col-md-6 d-flex justify-content-center">
                <div class="grafica-box">
                    <h6 class="text-center">📈 Línea</h6>
                    <canvas id="graficaLineal"></canvas>
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-center">
                <div class="grafica-box">
                    <h6 class="text-center">📊 Barras</h6>
                    <canvas id="graficaBarras"></canvas>
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-center">
                <div class="grafica-box">
                    <h6 class="text-center">🥧 Pastel</h6>
                    <canvas id="graficaPastel"></canvas>
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-center">
                <div class="grafica-box">
                    <h6 class="text-center">📉 Gaussiana</h6>
                    <canvas id="graficaGauss"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  const datosEvaluacion = [
    {% for d in datos %}
      {
        ciclo: "{{ d.anio }}",
        promedio: {{ d.promedio }}
      },
    {% endfor %}
  ];
</script>
<script src="{% static 'js/evaluacion_docente_concentrado.js' %}"></script>
{% endblock %}
