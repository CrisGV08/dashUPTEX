{% extends 'base_admin.html' %}
{% load static %}

{% block title %}ðŸ“˜ MatrÃ­cula por Cuatrimestre{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/matricula_por_cuatrimestre.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">

<div class="admin-panel">
  <h2 class="titulo-vista">ðŸ“˜ MatrÃ­cula por Cuatrimestre</h2>

  <!-- Filtros -->
  <form method="get" class="filtros">
    <div class="filtro-item">
      <label for="filtroCiclo">Ciclo:</label>
      <select name="ciclo" id="filtroCiclo">
        <option value="Todos">Todos</option>
        {% for c in ciclos %}
          <option value="{{ c.id }}" {% if filtro_ciclo == c.id|stringformat:"s" %}selected{% endif %}>
            {{ c.ciclo.anio }} - {{ c.periodo.clave }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="filtro-item">
      <label for="filtroPrograma">Programa Educativo:</label>
      <select name="programa" id="filtroPrograma">
        <option value="Todos">Todos</option>
        {% for p in programas %}
          <option value="{{ p.id }}" {% if filtro_programa == p.id|stringformat:"s" %}selected{% endif %}>{{ p.nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="filtro-item">
      <button type="submit" class="btn-admin">Aplicar filtros</button>
      <button type="button" id="btnDescargarPDF" class="btn-admin">ðŸ“„ Descargar PDF</button>
    </div>
  </form>

  <!-- Botones CSV -->
  <div class="filtros">
    <form method="get" action="{% url 'descargar_plantilla_matricula_cuatrimestre' %}">
      <button type="submit" class="btn-admin">ðŸ“¥ Descargar Plantilla CSV</button>
    </form>

    <form method="post" enctype="multipart/form-data" action="{% url 'subir_csv_matricula_cuatrimestre' %}">
      {% csrf_token %}
      <input type="file" name="archivo_csv" accept=".csv" required>
      <button type="submit" class="btn-admin">ðŸ“¤ Subir CSV</button>
    </form>
  </div>

  <!-- Tabla -->
  <div class="contenedor-tabla mt-4">
    <table class="crud-table">
      <thead>
        <tr>
          <th>Periodo</th>
          <th>Programa</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody>
        {% for fila in tabla %}
          <tr>
            <td>{{ fila.periodo }}</td>
            <td>{{ fila.programa }}</td>
            <td>{{ fila.cantidad }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="3">No hay datos disponibles.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- GrÃ¡ficas -->
<div id="contenedorGraficas" class="graficas mt-5" data-grafica-json='{{ datos_grafica|safe }}'>
    <canvas id="graficaBarras" width="600" height="300"></canvas>
    <canvas id="graficaLinea" width="600" height="300"></canvas>
    <canvas id="graficaPastel" width="600" height="300"></canvas>
    <canvas id="graficaGauss" width="600" height="300"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="{% static 'js/matricula_por_cuatrimestre.js' %}"></script>
{% endblock %}
