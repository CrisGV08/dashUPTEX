{% extends 'base.html' %}
{% load static %}

{% block title %}ðŸ“˜ MatrÃ­cula por Cuatrimestre{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/matricula_por_cuatrimestre.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

<div class="admin-panel">
  <h2 class="titulo-vista">ðŸ“˜ MatrÃ­cula por Cuatrimestre</h2>

  <!-- Filtros -->
  <form method="get" class="filtros">
    <div class="filtro-item">
      <label for="filtroCiclo">Ciclo:</label>
      <select name="ciclo" id="filtroCiclo">
        <option value="Todos">Todos</option>
        {% for c in ciclos %}
          <option value="{{ c.id }}" {% if filtro_ciclo == c.id|stringformat:"s" %}selected{% endif %}>
            {{ c.ciclo.anio }} - {{ c.periodo.clave }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="filtro-item">
      <label for="filtroPrograma">Programa Educativo:</label>
      <select name="programa" id="filtroPrograma">
        <option value="Todos">Todos</option>
        {% for p in programas %}
          <option value="{{ p.id }}" {% if filtro_programa == p.id|stringformat:"s" %}selected{% endif %}>{{ p.nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="filtro-item">
      <button type="submit" class="btn-admin">Aplicar filtros</button>
    </div>
  </form>

  <!-- Tabla -->
  <div class="contenedor-tabla mt-4">
    <table class="crud-table">
      <thead>
        <tr>
          <th>Periodo</th>
          <th>Programa</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody>
        {% for fila in tabla %}
          <tr>
            <td>{{ fila.periodo }}</td>
            <td>{{ fila.programa }}</td>
            <td>{{ fila.cantidad }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="3">No hay datos disponibles.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- GrÃ¡ficas -->
  <div id="contenedorGraficas" class="graficas mt-5" data-grafica-json='{{ datos_grafica|safe }}'>
    <canvas id="graficaBarras" class="grafica" height="70"></canvas>
    <canvas id="graficaLinea" class="grafica mt-4" height="70"></canvas>
    <canvas id="graficaPastel" class="grafica mt-4" height="70"></canvas>
    <canvas id="graficaGauss" class="grafica mt-4" height="70"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/matricula_por_cuatrimestre.js' %}"></script>
{% endblock %}
